<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>大型家具回收預約平台 - 資料庫設計</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 20px;
    }
    h1, h2 {
      color: #2C3E50;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background-color: #34495E;
      color: #fff;
    }
    .description {
      background-color: #f9f9f9;
      padding: 15px;
      margin-top: 10px;
      border: 1px solid #ccc;
    }
    .toggle-buttons {
      margin-bottom: 20px;
    }
    button {
      padding: 8px 16px;
      margin-right: 10px;
      font-size: 14px;
    }
    #table-view, #mermaid-view {
      display: none;
    }
    #table-view.active, #mermaid-view.active {
      display: block;
    }
    pre {
      background: #f9f9f9;
      padding: 20px;
      border: 1px solid #ddd;
      overflow-x: auto;
    }
    a{
        color: #2980B9;
        font-weight: bold;
    }
    a:hover{
        text-decoration: underline;
    }
    a:visited{
        color: #2980B9;
    }
  </style>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: false });
    window.renderMermaid = () => {
      mermaid.run({ nodes: [document.querySelector("#mermaid-graph")] });
    };
  </script>
</head>
<body>
<h1>大型家具回收預約平台 - 資料庫設計</h1>
<div class="toggle-buttons">
  <button onclick="showView('table')">📋 資料表檢視</button>
  <button onclick="showView('mermaid')">📊 ERD 流程圖</button>
  <a href="easy_er.html" target="_blank">簡易的流程圖</a>
  <a href="complicated_er.html" target="_blank">新的ERD流程圖</a>
</div>
<div id="table-view" class="active">
<!-- Users Table -->
<h2>1. `users` 表格</h2>
<table border="1">
  <thead>
  <tr>
    <th>欄位名稱</th>
    <th>參數型態</th>
    <th>描述</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>id</td>
    <td>INT</td>
    <td>主鍵，自增</td>
  </tr>
  <tr>
    <td>username</td>
    <td>VARCHAR(255)</td>
    <td>使用者名稱，唯一</td>
  </tr>
  <tr>
    <td>password</td>
    <td>VARCHAR(255)</td>
    <td>使用者密碼</td>
  </tr>
  <tr>
    <td>email</td>
    <td>VARCHAR(255)</td>
    <td>使用者電子郵件</td>
  </tr>
  <tr>
    <td>created_at</td>
    <td>TIMESTAMP</td>
    <td>註冊時間</td>
  </tr>
  <tr>
    <td>updated_at</td>
    <td>TIMESTAMP</td>
    <td>最後更新時間</td>
  </tr>
  <tr>
    <td>is_manager</td>
    <td>BOOLEAN</td>
    <td>是否為後台管理員</td>
  </tr>
  </tbody>
</table>

<!-- Furniture Requests Table -->
<h2>2. `furniture_requests` 表格</h2>
<table border="1">
  <thead>
  <tr>
    <th>欄位名稱</th>
    <th>參數型態</th>
    <th>描述</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>id</td>
    <td>INT</td>
    <td>主鍵，自增</td>
  </tr>
  <tr>
    <td>name</td>
    <td>VARCHAR(255)</td>
    <td>家具名稱</td>
  </tr>
  <tr>
    <td>type</td>
    <td>VARCHAR(100)</td>
    <td>家具類型</td>
  </tr>
  <tr>
    <td>dimensions</td>
    <td>VARCHAR(100)</td>
    <td>家具尺寸 (例如：長×寬×高)</td>
  </tr>
  <tr>
    <td>material</td>
    <td>VARCHAR(100)</td>
    <td>家具材料</td>
  </tr>
  <tr>
    <td>weight</td>
    <td>DECIMAL(10,2)</td>
    <td>家具重量 (公斤)</td>
  </tr>
  <tr>
    <td>status</td>
    <td>VARCHAR(50)</td>
    <td>家具回收狀態</td>
  </tr>
  <tr>
    <td>created_at</td>
    <td>TIMESTAMP</td>
    <td>建立時間</td>
  </tr>
  <tr>
    <td>updated_at</td>
    <td>TIMESTAMP</td>
    <td>最後更新時間</td>
  </tr>
  </tbody>
</table>

<!-- Recycling Points Table -->
<h2>3. `recycling_points` 表格</h2>
<table border="1">
  <thead>
  <tr>
    <th>欄位名稱</th>
    <th>參數型態</th>
    <th>描述</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>id</td>
    <td>INT</td>
    <td>主鍵，自增</td>
  </tr>
  <tr>
    <td>name</td>
    <td>VARCHAR(255)</td>
    <td>回收點名稱</td>
  </tr>
  <tr>
    <td>address</td>
    <td>VARCHAR(255)</td>
    <td>地址</td>
  </tr>
  <tr>
    <td>latitude</td>
    <td>DECIMAL(9,6)</td>
    <td>經度</td>
  </tr>
  <tr>
    <td>longitude</td>
    <td>DECIMAL(9,6)</td>
    <td>緯度</td>
  </tr>
  <tr>
    <td>available</td>
    <td>BOOLEAN</td>
    <td>是否可用</td>
  </tr>
  <tr>
    <td>created_at</td>
    <td>TIMESTAMP</td>
    <td>建立時間</td>
  </tr>
  <tr>
    <td>updated_at</td>
    <td>TIMESTAMP</td>
    <td>最後更新時間</td>
  </tr>
  </tbody>
</table>

<!-- Service Slots Table -->
<h2>4. `service_slots` 表格</h2>
<table border="1">
  <thead>
  <tr>
    <th>欄位名稱</th>
    <th>參數型態</th>
    <th>描述</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>id</td>
    <td>INT</td>
    <td>主鍵，自增</td>
  </tr>
  <tr>
    <td>user_id</td>
    <td>INT</td>
    <td>外鍵，指向 `Users` 表</td>
  </tr>
  <tr>
    <td>recycling_point_id</td>
    <td>INT</td>
    <td>外鍵，指向 `Recycling Points` 表</td>
  </tr>
  <tr>
    <td>date</td>
    <td>DATE</td>
    <td>回收日期</td>
  </tr>
  <tr>
    <td>time_slot</td>
    <td>VARCHAR(50)</td>
    <td>回收時段</td>
  </tr>
  <tr>
    <td>furniture_list</td>
    <td>TEXT</td>
    <td>家具清單 (JSON 格式)</td>
  </tr>
  <tr>
    <td>status</td>
    <td>VARCHAR(50)</td>
    <td>申請狀態 (NEW, ACCEPTED, CANCELED)</td>
  </tr>
  <tr>
    <td>created_at</td>
    <td>TIMESTAMP</td>
    <td>建立時間</td>
  </tr>
  <tr>
    <td>updated_at</td>
    <td>TIMESTAMP</td>
    <td>最後更新時間</td>
  </tr>
  </tbody>
</table>

<!-- Delivery Schedules Table -->
<h2>5. `delivery_schedules` 表格</h2>
<table border="1">
  <thead>
  <tr>
    <th>欄位名稱</th>
    <th>描述</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>schedule_id</td>
    <td>排程唯一識別碼 (Primary Key)</td>
  </tr>
  <tr>
    <td>request_id</td>
    <td>回收申請 ID (Foreign Key, 來自 `furniture_requests`)</td>
  </tr>
  <tr>
    <td>vehicle_id</td>
    <td>車輛 ID (Foreign Key, 來自 `vehicles`)</td>
  </tr>
  <tr>
    <td>eta</td>
    <td>預計到達時間（ETA）</td>
  </tr>
  <tr>
    <td>status</td>
    <td>排程狀態 (如 PENDING, IN_PROGRESS, COMPLETED 等)</td>
  </tr>
  </tbody>
</table>

<!-- Vehicles Table -->
<h2>6. `vehicles` 表格</h2>
<table border="1">
  <thead>
  <tr>
    <th>欄位名稱</th>
    <th>描述</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>vehicle_id</td>
    <td>車輛唯一識別碼 (Primary Key)</td>
  </tr>
  <tr>
    <td>plate_number</td>
    <td>車輛車牌號碼</td>
  </tr>
  <tr>
    <td>capacity_length</td>
    <td>車輛容量長度</td>
  </tr>
  <tr>
    <td>capacity_width</td>
    <td>車輛容量寬度</td>
  </tr>
  <tr>
    <td>capacity_height</td>
    <td>車輛容量高度</td>
  </tr>
  <tr>
    <td>status</td>
    <td>車輛狀態 (如 AVAILABLE, IN_USE, MAINTENANCE 等)</td>
  </tr>
  </tbody>
</table>

<!-- Reports Table -->
<h2>7. `reports` 表格</h2>
<table border="1">
  <thead>
  <tr>
    <th>欄位名稱</th>
    <th>描述</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>report_id</td>
    <td>報表唯一識別碼 (Primary Key)</td>
  </tr>
  <tr>
    <td>report_data</td>
    <td>報表內容（通常為 JSON 格式）</td>
  </tr>
  <tr>
    <td>created_at</td>
    <td>報表創建時間</td>
  </tr>
  </tbody>
</table>
</div>
<!-- Mermaid ERD -->
<div id="mermaid-view">
  <div class="mermaid" id="mermaid-graph">
    erDiagram
    %% 核心使用者與權限
    USERS {
    INT id PK
    VARCHAR username
    VARCHAR password
    VARCHAR email
    BOOLEAN is_manager "管理員/一般用戶"
    TIMESTAMP created_at
    TIMESTAMP updated_at
    }

    %% 駕駛資訊 (因排程流程提到駕駛)
    DRIVERS {
    INT id PK
    VARCHAR name
    VARCHAR phone
    VARCHAR license_number
    VARCHAR status "在職/休假"
    }

    %% 回收點地點資訊 (Recycling Points)
    RECYCLING_POINTS {
    INT id PK
    VARCHAR name "站點名稱"
    VARCHAR address "地址"
    DECIMAL latitude
    DECIMAL longitude
    BOOLEAN is_active "是否啟用 (對應用戶流程的'可用')"
    TIMESTAMP created_at
    }

    %% 回收點時段名額設定 (Capacity for specific slots) - 解決名額需求
    CAPACITY_SLOTS {
    INT id PK
    INT recycling_point_id FK
    DATE date "特定日期"
    VARCHAR time_slot "特定時段 (ex. '9:00-11:00')"
    INT capacity_limit "時段名額上限"
    INT booked_count "已預約數量"
    }

    %% 預約主單 (Service Slots) - 用戶預約的單一時間/地點
    SERVICE_SLOTS {
    INT id PK
    INT user_id FK
    INT capacity_slot_id FK "關聯到名額設定"
    VARCHAR status "申請狀態 (Pending/Approved/Rejected)"
    TIMESTAMP created_at
    TIMESTAMP updated_at
    VARCHAR admin_notes "管理員審核備註"
    }

    %% 傢俱資料 (Furniture Requests) - 預約單底下的多件傢俱資訊 (已正規化)
    FURNITURE_REQUESTS {
    INT id PK
    INT service_slot_id FK "隸屬於哪個預約單"
    VARCHAR name "傢俱名稱"
    VARCHAR type "類別"
    VARCHAR dimensions "尺寸"
    VARCHAR material "材質"
    DECIMAL weight "估計重量"
    VARCHAR photo_url "照片連結 (Optional)"
    VARCHAR rejection_reason "退件原因 (對應後台流程)"
    }

    %% 車輛資訊 (Vehicles) - 納入管理流程所需的日期資訊
    VEHICLES {
    INT id PK
    VARCHAR plate_number "車牌"
    DECIMAL capacity_length "載重_長"
    DECIMAL capacity_width "載重_寬"
    DECIMAL capacity_height "載重_高"
    VARCHAR status "狀態 (Active/Disabled)"
    DATE manufacture_date "出廠日"
    DATE inspection_date "定檢日"
    DATE maintenance_date "保養日"
    }

    %% 派車排程 (Delivery Schedules) - 路徑規劃的核心
    DELIVERY_SCHEDULES {
    INT id PK
    INT service_slot_id FK "本次排程服務的預約單"
    INT vehicle_id FK
    INT driver_id FK "本次任務指派的駕駛"
    DATETIME scheduled_pickup_time "預計取件時間 (ETA)"
    DATETIME actual_pickup_time "實際取件時間"
    VARCHAR status "排程狀態 (Assigned/On_Route/Completed)"
    }

    %% 報表資料 (Reports) - 存儲報表生成的結果或摘要
    REPORTS {
    INT id PK
    DATETIME start_date
    DATETIME end_date
    VARCHAR report_type "報表類型 (e.g. 案件數統計/完成率分析)"
    JSON summary_data "統計摘要資料 (而非所有原始資料)"
    BLOB csv_file "導出的CSV檔案"
    TIMESTAMP created_at
    }

    %% 關聯關係
    USERS ||--o{ SERVICE_SLOTS : has_made
    RECYCLING_POINTS ||--o{ CAPACITY_SLOTS : defines_capacity
    CAPACITY_SLOTS ||--o{ SERVICE_SLOTS : is_booked_against

    SERVICE_SLOTS ||--o{ FURNITURE_REQUESTS : includes
    SERVICE_SLOTS ||--o{ DELIVERY_SCHEDULES : is_scheduled_for

    VEHICLES ||--o{ DELIVERY_SCHEDULES : is_used_in
    DRIVERS ||--o{ DELIVERY_SCHEDULES : drives_in

    SERVICE_SLOTS ||--o{ REPORTS : summarizes_slot_data
    DELIVERY_SCHEDULES ||--o{ REPORTS : summarizes_delivery_data

  </div>
</div>

<script>
  function showView(view) {
    document.getElementById('table-view').classList.remove('active');
    document.getElementById('mermaid-view').classList.remove('active');

    if (view === 'table') {
      document.getElementById('table-view').classList.add('active');
    } else {
      document.getElementById('mermaid-view').classList.add('active');
      window.renderMermaid();
    }
  }
</script>
</body>
</html>